<html>
    <head>
        <title>Create - Spanglish Reader</title>
        <link rel="stylesheet" href="assets/style.css">
        <script src="assets/script.js"></script>
        <style>
            #textarea-input {
                width: 100%;
                height: 90%;
            }
        </style>
    </head>
    <body>
        <div class="center" id="first-div">
            <span class="title">Upload Spanglish</span>
            <textarea id="textarea-input" class="default"></textarea>
            <button onclick="saveText()" class="button save">Save</button>
            <a href="help"><button class="button red float-right">Help!</button></a>
        </div>
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="document.getElementbyId(`modal`).style.display = `none`;">&#x274c;</span>
                <p class="important">Your text has uploaded.<Br>It should be available at <a id="success-url"></a><span id="modal-status"></span></p>
            </div>
          
          </div>
    </body>
    <script>
        function toggleDm(){
            var el = document.getElementById('textarea-input');
            el.classList.toggle('dark-mode');
            toggleDarkmode();
        };
		
		async function saveText(){
            startLoading();
			const el = document.getElementById('textarea-input');
			const txt = el.value;

            console.log("Making request to api...");
            const res = await fetch(`http://127.0.0.1:80/api/v1/upload`, {
                body: JSON.stringify({"text": txt}),
                method: "POST"
            }).catch((error) => {
                alert('I could not connect to my API. Please try again later.');
                return
            });
            const data = await res.json()
            console.log(`Received ${data}`);
            
            stopLoading();
            if (data.success === false){
                alert(data.error);
            } else {
                const url = `${window.location.href.split("/upload")[0]}/read/${data.id}`;
                const modal = document.getElementById('modal');
                const successUrl = document.getElementById('success-url');
                const modalStatus = document.getElementById('modal-status');
                
                successUrl.href = url;
                successUrl.innerText = url;
                modal.style.display = 'block';
                modalStatus.innerHTML = " soon. <br> It normally takes about a minute to appear.";
                await sleep(60 * 1000);
                modalStatus.innerText = "."
            }
		};
    </script>
</html>